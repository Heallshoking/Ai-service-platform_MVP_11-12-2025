#!/usr/bin/expect -f
# ĞŸĞ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ´ĞµĞ¿Ğ»Ğ¾Ğ¹ Ñ expect

set timeout 600
set password "pneDRE2K?Tz1k-"
set host "root@176.98.178.109"
set archive "electric-service-automation-main.tar.gz"

# ĞšĞ¾Ğ¿Ğ¸Ñ€ÑƒĞµĞ¼ Ğ°Ñ€Ñ…Ğ¸Ğ²
puts "\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
puts "  ğŸ“¤ ĞšĞĞŸĞ˜Ğ ĞĞ’ĞĞĞ˜Ğ• ĞĞ VPS"
puts "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n"

spawn scp $archive $host:/tmp/
expect {
    "password:" {
        send "$password\r"
        exp_continue
    }
    "yes/no" {
        send "yes\r"
        exp_continue
    }
    eof
}

puts "\nâœ… ĞÑ€Ñ…Ğ¸Ğ² ÑĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½!\n"

# Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµĞ¼ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ½Ğ° VPS
puts "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
puts "  ğŸ”¨ Ğ¡Ğ‘ĞĞ ĞšĞ ĞĞ VPS"
puts "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n"

spawn ssh $host
expect "password:"
send "$password\r"
expect "# "

send "cd /tmp\r"
expect "# "

send "tar -xzf $archive\r"
expect "# "
puts "  âœ“ ĞÑ€Ñ…Ğ¸Ğ² Ñ€Ğ°ÑĞ¿Ğ°ĞºĞ¾Ğ²Ğ°Ğ½"

send "cd electric-service-automation-main\r"
expect "# "

send "npm install 2>&1 | tail -5\r"
expect "# " {
    puts "  âœ“ Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹"
}

send "npm run build 2>&1 | tail -10\r"
expect "# " {
    puts "  âœ“ ĞŸÑ€Ğ¾ĞµĞºÑ‚ ÑĞ¾Ğ±Ñ€Ğ°Ğ½"
}

send "cp -r dist/* /var/www/app.balt-set.ru/\r"
expect "# "
puts "  âœ“ Ğ¤Ğ°Ğ¹Ğ»Ñ‹ ÑĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹"

send "chmod -R 755 /var/www/app.balt-set.ru/\r"
expect "# "
puts "  âœ“ ĞŸÑ€Ğ°Ğ²Ğ° ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹"

send "ls -la /var/www/app.balt-set.ru/ | head -5\r"
expect "# "

send "exit\r"
expect eof

puts "\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
puts "  âœ… Ğ”Ğ•ĞŸĞ›ĞĞ™ Ğ—ĞĞ’Ğ•Ğ Ğ¨Ğ•Ğ!"
puts "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n"
puts "ğŸŒ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ: https://app.balt-set.ru/\n"
puts "âœ… Ğ§Ñ‚Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ğ»Ğ¾ÑÑŒ:"
puts "  1. 'ĞĞ°ÑˆĞ¸ ÑƒÑĞ»ÑƒĞ³Ğ¸' â†’ 'Ğ£ÑĞ»ÑƒĞ³Ğ¸ ÑĞ»ĞµĞºÑ‚Ñ€Ğ¸ĞºĞ°'"
puts "  2. Ğ£Ğ¿Ñ€Ğ¾Ñ‰ĞµĞ½Ğ½Ñ‹Ğµ ÑĞºĞ¸Ğ´ĞºĞ¸ (Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ 15%):"
puts "     â€¢ 5+ ÑˆÑ‚ â†’ 10%"
puts "     â€¢ 10+ ÑˆÑ‚ â†’ 15%"
puts "  3. ĞšĞ½Ğ¾Ğ¿ĞºĞ° 'â† Ğš ÑƒÑĞ»ÑƒĞ³Ğ°Ğ¼' Ğ² ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ğµ\n"
puts "ğŸ§ª ĞŸÑ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ:"
puts "  â€¢ Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ 5 Ñ€Ğ¾Ğ·ĞµÑ‚Ğ¾Ğº â†’ ÑĞºĞ¸Ğ´ĞºĞ° 10%"
puts "  â€¢ Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ 10 Ñ€Ğ¾Ğ·ĞµÑ‚Ğ¾Ğº â†’ ÑĞºĞ¸Ğ´ĞºĞ° 15%\n"
