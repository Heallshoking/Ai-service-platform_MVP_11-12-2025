# 🍱 СИСТЕМА "СУШИ-МАРКЕТ" ДЛЯ ЭЛЕКТРОМОНТАЖА

## 🎯 НАШЛИ! ВОТ ТА САМАЯ СТРАНИЦА!

### 📍 Расположение в electric-service-automation-main:

```
src/pages/
├── Index.tsx              ← ГЛАВНАЯ с 3 табами (Услуги/Калькулятор/Заказ)
├── Products.tsx           ← СТРАНИЦА С ЧЕКБОКСАМИ (как суши-маркет!)
└── Cart.tsx               ← КОРЗИНА С ИТОГОВОЙ СМЕТОЙ

src/components/index/
├── ServicesTab.tsx        ← Таб "Услуги" (быстрый выбор)
├── CalculatorTab.tsx      ← Таб "Калькулятор" (за 60 сек!)
└── OrderTab.tsx           ← Таб "Оформление заказа"

src/components/auth/
└── TelegramAuthButton.tsx ← АВТОРИЗАЦИЯ ЧЕРЕЗ TELEGRAM!
```

---

## 🚀 ТА САМАЯ СТРАНИЦА "РАСЧЁТ СМЕТЫ ЗА 60 СЕКУНД"

### Это **Index.tsx** с тремя табами:

```typescript
// 3 ТАБА НА ОДНОЙ СТРАНИЦЕ:

1️⃣ УСЛУГИ (ServicesTab)
   - Быстрый выбор популярных услуг
   - Кнопки +/- для количества
   - Добавление в корзину

2️⃣ КАЛЬКУЛЯТОР (CalculatorTab) ← ВОТ ОНО! "ЗА 60 СЕКУНД"
   - Выбор сценария (новая проводка/ремонт/частичная замена)
   - Тип ремонта (черновой/чистовой/косметический)
   - Количество выключателей/розеток
   - Тип освещения
   - Мощное оборудование
   - ТИП МОНТАЖА
   - Наличие проводов
   
3️⃣ ЗАКАЗ (OrderTab)
   - Выбор исполнителя
   - Телефон, адрес, дата, время
   - Примечания
   - ОФОРМЛЕНИЕ!
```

---

## 🍱 СИСТЕМА "КАК СУШИ-МАРКЕТ" - Products.tsx

### Как это работает:

```typescript
// ПОЛЬЗОВАТЕЛЬ КЛИКАЕТ ПО УСЛУГАМ:

1. Открывает ServiceContainerCard
   ├── Видит список услуг с ценами
   ├── КЛИКАЕТ по чекбоксу ✓
   └── Услуга добавляется!

2. Настраивает количество
   ├── Кнопка [-] уменьшить
   ├── Показывает текущее количество
   └── Кнопка [+] увеличить

3. АВТОМАТИЧЕСКИ применяются скидки
   ├── От 5 шт. → 10%
   ├── От 10 шт. → 15%
   └── От 10 шт. автоматы → 50%!

4. Видит ИТОГО в реальном времени
   └── Автоматический пересчёт при каждом клике
```

---

## 📱 АВТОРИЗАЦИЯ ЧЕРЕЗ TELEGRAM

### TelegramAuthButton.tsx:

```typescript
// ПРОЦЕСС АВТОРИЗАЦИИ:

1. Пользователь открывает через Telegram Web App
   └── window.Telegram.WebApp.initData

2. Нажимает кнопку "Войти через Telegram"
   └── Отправка initData на сервер

3. Сервер проверяет данные
   └── Возвращает user.uid, user.name, user.role

4. Пользователь авторизован!
   └── Доступ к расчёту сметы
```

### Код авторизации:

```typescript
const handleTelegramAuth = async () => {
  const response = await fetch('https://functions.poehali.dev/...', {
    method: 'POST',
    body: JSON.stringify({
      initData: window.Telegram.WebApp.initData,
      role: 'client' // или 'executor'
    })
  });
  
  const data = await response.json();
  
  if (data.success && data.user) {
    login({
      uid: data.user.uid,
      name: data.user.name,
      role: data.user.role
    });
  }
};
```

---

## 🧮 КАЛЬКУЛЯТОР "ЗА 60 СЕКУНД" - CalculatorTab.tsx

### Что пользователь выбирает:

```typescript
// ШАГ 1: СЦЕНАРИЙ
scenario: 'new-wiring' | 'renovation' | 'partial'
• Новая проводка
• Ремонт существующей
• Частичная замена

// ШАГ 2: ТИП РЕМОНТА
repairType: 'rough' | 'clean' | 'cosmetic'
• Черновой (со штроблением)
• Чистовой (скрытый монтаж)
• Косметический (накладной)

// ШАГ 3: КОЛИЧЕСТВО
switchCount: number    // Выключатели
socketCount: number    // Розетки

// ШАГ 4: ОСВЕЩЕНИЕ
lightingType: 'basic' | 'extended' | 'smart'
• Базовое
• Расширенное
• Умное освещение

// ШАГ 5: МОЩНОЕ ОБОРУДОВАНИЕ
powerEquipment: string[]
• Электроплита
• Стиральная машина
• Кондиционер
• Бойлер

// ШАГ 6: ТИП УСТАНОВКИ
installType: 'hidden' | 'surface'
• Скрытый монтаж
• Накладной монтаж

// ШАГ 7: ПРОВОДА
hasWires: boolean
• Есть провода
• Нужно прокладывать
```

---

## 🛒 КОРЗИНА - Cart.tsx

### Функционал корзины:

```typescript
// ЧТО ПОКАЗЫВАЕТСЯ В КОРЗИНЕ:

1. СПИСОК ЗАДАЧ
   ├── #1 Установить светильник × 5 шт. → 4500₽ (скидка 10%)
   ├── #2 Установить розетку × 10 шт. → 2250₽ (скидка 10%)
   └── #3 Установить выключатель × 6 шт. → 1350₽ (скидка 10%)

2. АВТОМАТИЧЕСКИ ДОБАВЛЕН КАБЕЛЬ
   ├── Ориентировочный расход: ~45 метров
   ├── Стоимость монтажа: 4500₽
   └── Скидка за объем 5%: -225₽

3. ИТОГО
   ├── Работы без кабеля: 8100₽
   ├── Монтаж кабеля (45м): 4275₽
   ├── Общая экономия: -825₽
   └── ИТОГО: 12375₽

4. РЕЖИМ РЕДАКТИРОВАНИЯ
   ├── Кнопка "Редактировать"
   ├── Изменение количества (+/-)
   ├── Удаление позиций
   └── Возврат к выбору услуг
```

---

## 💡 КЛЮЧЕВЫЕ ФИЧИ СИСТЕМЫ

### 1. **Три способа расчёта:**

```typescript
// ВАРИАНТ А: Быстрый выбор (ServicesTab)
└── Популярные услуги с кнопками +/-

// ВАРИАНТ Б: Калькулятор за 60 сек (CalculatorTab)
└── Пошаговый опрос → автоматический расчёт

// ВАРИАНТ В: Подробный выбор (Products.tsx)
└── Как суши-маркет с чекбоксами
```

### 2. **Автоматические расчёты:**

```typescript
// СКИДКИ НА УСЛУГИ:
getDiscount(quantity):
  if (quantity >= 10) return 15;
  if (quantity >= 5) return 10;
  if (quantity >= 3) return 5;
  return 0;

// СКИДКИ НА КАБЕЛЬ:
getCableDiscount(meters):
  if (meters > 200) return 20;
  if (meters > 100) return 10;
  if (meters > 50) return 5;
  return 0;

// РАСЧЁТ КАБЕЛЯ:
calculateFrames(items):
  // Автоматический подсчёт рамок и метража
```

### 3. **Визуализация:**

```typescript
// ПРОГРЕСС-БАР
// ИТОГО В РЕАЛЬНОМ ВРЕМЕНИ
// ПРИМЕНЕННЫЕ СКИДКИ
// ЭКОНОМИЯ
```

---

## 🎨 ИНТЕРФЕЙС "СУШИ-МАРКЕТ"

### Products.tsx - Контейнеры с услугами:

```
┌─────────────────────────────────────┐
│ 💡 УСТАНОВИТЬ СВЕТИЛЬНИК            │
│ ─────────────────────────────────── │
│ ☐ Установить светильник    +1000₽  │
│ ☐ Демонтаж                  +500₽  │
│ ☐ Сборка люстры             +500₽  │
│ ☐ Подвес хрусталя          +1500₽  │
└─────────────────────────────────────┘

ПОЛЬЗОВАТЕЛЬ КЛИКАЕТ ☑ → 

┌─────────────────────────────────────┐
│ 💡 УСТАНОВИТЬ СВЕТИЛЬНИК            │
│ ─────────────────────────────────── │
│ ☑ Установить светильник             │
│   [－] 5 [＋]              4500₽    │
│   💰 Скидка 10% от 5 шт. ✓         │
└─────────────────────────────────────┘
```

---

## 📊 ПРИМЕР ПОЛНОГО ПРОЦЕССА

### Пользователь заходит на сайт:

```
1. Открывает Index.tsx
   └── Видит 3 таба: Услуги | Калькулятор | Заказ

2. Выбирает таб "Калькулятор"
   ├── Новая проводка? → Да
   ├── Черновой ремонт? → Да
   ├── Выключатели? → 15 шт.
   ├── Розетки? → 25 шт.
   ├── Освещение? → Расширенное
   ├── Плита + Бойлер? → Да
   └── Время: 45 секунд ✓

3. Система автоматически рассчитывает
   └── ИТОГО: ~85,000₽

4. Переходит к "Заказ"
   ├── Вводит телефон
   ├── Вводит адрес
   ├── Выбирает дату
   └── ОТПРАВЛЯЕТ!
```

---

## 🔗 ИНТЕГРАЦИЯ В APP.BALT-SET.RU

### Что нужно скопировать:

```bash
# ИЗ electric-service-automation-main:

/src/pages/
├── Index.tsx              → ГЛАВНАЯ СТРАНИЦА
├── Products.tsx           → СТРАНИЦА С ЧЕКБОКСАМИ
└── Cart.tsx               → КОРЗИНА

/src/components/index/
├── ServicesTab.tsx        → Таб услуг
├── CalculatorTab.tsx      → Таб калькулятора
├── OrderTab.tsx           → Таб заказа
└── useIndexLogic.ts       → Логика расчётов

/src/components/products/
├── ServiceContainerCard.tsx   → Карточки услуг
├── types.ts                   → Типы
├── initialContainers.ts       → Данные услуг
└── useProductsLogic.ts        → Логика

/src/components/auth/
└── TelegramAuthButton.tsx     → Авторизация

/src/contexts/
└── CartContext.tsx            → Контекст корзины
```

---

## 🚀 АДАПТАЦИЯ ПОД HTML

### Вариант 1: Простая HTML версия Index

```html
<!DOCTYPE html>
<html>
<head>
  <title>Расчёт сметы за 60 секунд</title>
</head>
<body>
  <!-- ТАБЫ -->
  <div class="tabs">
    <button onclick="showTab('services')">Услуги</button>
    <button onclick="showTab('calculator')">Калькулятор</button>
    <button onclick="showTab('order')">Заказ</button>
  </div>
  
  <!-- ТАБ КАЛЬКУЛЯТОР -->
  <div id="calculator-tab">
    <h2>Расчёт сметы за 60 секунд</h2>
    
    <label>Сценарий:</label>
    <select id="scenario">
      <option value="new">Новая проводка</option>
      <option value="renovation">Ремонт</option>
      <option value="partial">Частичная замена</option>
    </select>
    
    <label>Выключатели:</label>
    <input type="number" id="switches" min="0" value="0">
    
    <label>Розетки:</label>
    <input type="number" id="sockets" min="0" value="0">
    
    <button onclick="calculate()">Рассчитать</button>
    
    <div id="result"></div>
  </div>
  
  <script src="calculator-logic.js"></script>
</body>
</html>
```

### Вариант 2: С авторизацией Telegram

```html
<!-- Проверка авторизации -->
<script>
  if (window.Telegram && window.Telegram.WebApp) {
    // Пользователь зашёл через Telegram
    const initData = window.Telegram.WebApp.initData;
    
    // Отправляем на сервер для проверки
    fetch('/api/telegram-auth', {
      method: 'POST',
      body: JSON.stringify({ initData })
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        // Показываем калькулятор
        document.getElementById('calculator').style.display = 'block';
      }
    });
  }
</script>
```

---

## 📱 TELEGRAM WEB APP ИНТЕГРАЦИЯ

### Создание бота с Web App:

```python
# В telegram_client_bot.py:

from telegram import WebAppInfo

# Кнопка с Web App
keyboard = InlineKeyboardMarkup([
    [InlineKeyboardButton(
        "🧮 Рассчитать смету",
        web_app=WebAppInfo(url="https://app.balt-set.ru/calculator")
    )]
])

await update.message.reply_text(
    "Выберите действие:",
    reply_markup=keyboard
)
```

---

## ✅ ИТОГ

### ВЫ ДОДЕЛАЛИ СТРАНИЦУ:

✅ **Index.tsx** - 3 таба в одном (Услуги/Калькулятор/Заказ)
✅ **CalculatorTab.tsx** - Расчёт сметы за 60 секунд!
✅ **Products.tsx** - Система "суши-маркет" с чекбоксами
✅ **Cart.tsx** - Корзина с автоматическими скидками
✅ **TelegramAuthButton.tsx** - Авторизация через Telegram

### ОСНОВНЫЕ ФИЧИ:

🎯 Расчёт сметы за 60 секунд (7 простых вопросов)
🍱 Выбор услуг как в суши-маркете (клик → добавлено)
💰 Автоматические скидки (10%, 15%, 50%)
🧮 Автоматический расчёт кабеля и рамок
📱 Авторизация через Telegram Web App
🛒 Умная корзина с редактированием
📊 Визуализация экономии в реальном времени

---

**🚀 ЭТА СИСТЕМА УЖЕ ГОТОВА В electric-service-automation-main!**

Файлы расположены в:
- `/src/pages/Index.tsx` - ГЛАВНАЯ
- `/src/pages/Products.tsx` - СУШИ-МАРКЕТ
- `/src/pages/Cart.tsx` - КОРЗИНА
- `/src/components/auth/TelegramAuthButton.tsx` - АВТОРИЗАЦИЯ
