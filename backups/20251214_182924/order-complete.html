<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç | –ë–ê–õ–¢–°–ï–¢–¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 28px;
            color: #667eea;
            margin-bottom: 8px;
        }
        
        .subtitle {
            color: #999;
            font-size: 14px;
        }
        
        .order-info {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .info-row:last-child {
            border-bottom: none;
        }
        
        .info-label {
            color: #666;
            font-size: 14px;
        }
        
        .info-value {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }
        
        .photo-upload {
            margin-bottom: 25px;
        }
        
        .upload-area {
            border: 2px dashed #e0e0e0;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upload-area:hover {
            border-color: #667eea;
            background: #f8f9fa;
        }
        
        .upload-area.dragover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }
        
        .upload-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .upload-text {
            font-size: 16px;
            color: #666;
            margin-bottom: 8px;
        }
        
        .upload-hint {
            font-size: 12px;
            color: #999;
        }
        
        .photo-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .photo-item {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            aspect-ratio: 1;
        }
        
        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .photo-remove {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 28px;
            height: 28px;
            background: rgba(239, 68, 68, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            font-size: 18px;
            font-weight: bold;
        }
        
        .comment-section {
            margin-bottom: 25px;
        }
        
        .comment-section label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }
        
        .comment-section textarea {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        .comment-section textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .buttons {
            display: grid;
            gap: 12px;
        }
        
        .btn {
            padding: 16px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            text-align: center;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: #666;
            border: 2px solid #e0e0e0;
        }
        
        .btn-secondary:hover {
            background: #e9ecef;
        }
        
        .success-screen {
            display: none;
            text-align: center;
            padding: 40px 20px;
        }
        
        .success-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }
        
        .success-screen h2 {
            color: #10b981;
            margin-bottom: 15px;
        }
        
        .success-screen p {
            color: #666;
            margin-bottom: 25px;
            line-height: 1.6;
        }
        
        .payment-info {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-left: 4px solid #667eea;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 25px;
            font-size: 14px;
        }
        
        .payment-amount {
            font-size: 24px;
            font-weight: 700;
            color: #667eea;
            margin: 10px 0;
        }
        
        input[type="file"] {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="confirmScreen">
            <div class="header">
                <h1>‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–∞–±–æ—Ç</h1>
                <p class="subtitle">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç</p>
            </div>
            
            <div class="order-info">
                <h3 style="margin-bottom: 15px; color: #333;">üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ</h3>
                <div class="info-row">
                    <span class="info-label">–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞:</span>
                    <span class="info-value" id="orderNumber">#123456</span>
                </div>
                <div class="info-row">
                    <span class="info-label">–ö–ª–∏–µ–Ω—Ç:</span>
                    <span class="info-value" id="clientName">–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤</span>
                </div>
                <div class="info-row">
                    <span class="info-label">–£—Å–ª—É–≥–∞:</span>
                    <span class="info-value" id="serviceName">–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–æ–∑–µ—Ç–æ–∫</span>
                </div>
                <div class="info-row">
                    <span class="info-label">–°—É–º–º–∞ –∑–∞–∫–∞–∑–∞:</span>
                    <span class="info-value" id="orderAmount">2 000 ‚ÇΩ</span>
                </div>
            </div>
            
            <div class="payment-info">
                <div style="font-weight: 600; color: #667eea; margin-bottom: 8px;">üí∞ –í–∞—à–∞ –≤—ã–ø–ª–∞—Ç–∞</div>
                <div>–ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–º –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:</div>
                <div class="payment-amount" id="masterPayment">1 500 ‚ÇΩ</div>
                <div style="font-size: 12px; color: #999;">75% –æ—Ç —Å—É–º–º—ã –∑–∞–∫–∞–∑–∞</div>
            </div>
            
            <div class="photo-upload">
                <label style="display: block; font-weight: 600; color: #333; margin-bottom: 12px;">
                    üì∏ –§–æ—Ç–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
                </label>
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">üì∑</div>
                    <div class="upload-text">–ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–æ—Ç–æ</div>
                    <div class="upload-hint">–ú–∏–Ω–∏–º—É–º 2 —Ñ–æ—Ç–æ, –º–∞–∫—Å–∏–º—É–º 10</div>
                </div>
                <input type="file" id="fileInput" accept="image/*" multiple>
                <div class="photo-preview" id="photoPreview"></div>
            </div>
            
            <div class="comment-section">
                <label for="workComment">üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ —Ä–∞–±–æ—Ç–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                <textarea 
                    id="workComment" 
                    placeholder="–û–ø–∏—à–∏—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ —Ç.–¥."
                ></textarea>
            </div>
            
            <div class="buttons">
                <button class="btn btn-primary" onclick="confirmCompletion()" id="confirmBtn" disabled>
                    ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
                </button>
                <button class="btn btn-secondary" onclick="window.location.href='/catalog.html'">
                    ‚Üê –û—Ç–º–µ–Ω–∞
                </button>
            </div>
        </div>
        
        <div id="successScreen" class="success-screen">
            <div class="success-icon">üéâ</div>
            <h2>–†–∞–±–æ—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞!</h2>
            <p>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–ª–∏–µ–Ω—Ç—É. –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å –µ–≥–æ —Å—Ç–æ—Ä–æ–Ω—ã —Å—Ä–µ–¥—Å—Ç–≤–∞ –±—É–¥—É—Ç –ø–µ—Ä–µ–≤–µ–¥–µ–Ω—ã –Ω–∞ –≤–∞—à —Å—á—ë—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 1-3 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π.</p>
            <div class="payment-info" style="text-align: left;">
                <div style="font-weight: 600; color: #667eea; margin-bottom: 10px;">üìä –î–µ—Ç–∞–ª–∏ –≤—ã–ø–ª–∞—Ç—ã</div>
                <div class="info-row">
                    <span class="info-label">–°—É–º–º–∞ –∑–∞–∫–∞–∑–∞:</span>
                    <span class="info-value" id="successOrderAmount">2 000 ‚ÇΩ</span>
                </div>
                <div class="info-row">
                    <span class="info-label">–ö–æ–º–∏—Å—Å–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (25%):</span>
                    <span class="info-value" id="successCommission">500 ‚ÇΩ</span>
                </div>
                <div class="info-row">
                    <span class="info-label">–í–∞—à–∞ –≤—ã–ø–ª–∞—Ç–∞ (75%):</span>
                    <span class="info-value" style="color: #10b981; font-size: 18px;" id="successPayout">1 500 ‚ÇΩ</span>
                </div>
            </div>
            <button class="btn btn-primary" onclick="window.location.href='/catalog.html'">
                –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∑–∞–∫–∞–∑–∞–º
            </button>
        </div>
    </div>
    
    <script>
        const PLATFORM_COMMISSION = 0.25;
        const MASTER_PAYOUT = 0.75;
        
        let uploadedPhotos = [];
        let orderData = null;
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–∞
        function loadOrderData() {
            // –ü–æ–ª—É—á–∏—Ç—å ID –∑–∞–∫–∞–∑–∞ –∏–∑ URL
            const urlParams = new URLSearchParams(window.location.search);
            const orderId = urlParams.get('order');
            
            // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ localStorage (–≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ ‚Äî –∏–∑ API)
            const orders = JSON.parse(localStorage.getItem('orders') || '[]');
            orderData = orders.find(o => o.id.toString() === orderId);
            
            if (!orderData) {
                // –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
                orderData = {
                    id: 123456,
                    clientName: '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤',
                    serviceName: '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–æ–∑–µ—Ç–æ–∫',
                    total: 2000,
                    commission: 500,
                    master_payout: 1500
                };
            }
            
            // –ó–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            document.getElementById('orderNumber').textContent = '#' + orderData.id;
            document.getElementById('clientName').textContent = orderData.clientName || '–ö–ª–∏–µ–Ω—Ç';
            document.getElementById('serviceName').textContent = orderData.serviceName || orderData.items?.[0]?.name || '–£—Å–ª—É–≥–∞';
            document.getElementById('orderAmount').textContent = orderData.total.toLocaleString('ru-RU') + ' ‚ÇΩ';
            
            const masterPayout = Math.round(orderData.total * MASTER_PAYOUT);
            document.getElementById('masterPayment').textContent = masterPayout.toLocaleString('ru-RU') + ' ‚ÇΩ';
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const photoPreview = document.getElementById('photoPreview');
        const confirmBtn = document.getElementById('confirmBtn');
        
        uploadArea.addEventListener('click', () => fileInput.click());
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });
        
        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });
        
        function handleFiles(files) {
            const fileArray = Array.from(files);
            
            if (uploadedPhotos.length + fileArray.length > 10) {
                alert('–ú–∞–∫—Å–∏–º—É–º 10 —Ñ–æ—Ç–æ');
                return;
            }
            
            fileArray.forEach(file => {
                if (!file.type.startsWith('image/')) {
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    uploadedPhotos.push({
                        url: e.target.result,
                        file: file
                    });
                    renderPhotos();
                    updateConfirmButton();
                };
                reader.readAsDataURL(file);
            });
        }
        
        function renderPhotos() {
            photoPreview.innerHTML = uploadedPhotos.map((photo, index) => `
                <div class="photo-item">
                    <img src="${photo.url}" alt="–§–æ—Ç–æ ${index + 1}">
                    <div class="photo-remove" onclick="removePhoto(${index})">√ó</div>
                </div>
            `).join('');
        }
        
        function removePhoto(index) {
            uploadedPhotos.splice(index, 1);
            renderPhotos();
            updateConfirmButton();
        }
        
        function updateConfirmButton() {
            confirmBtn.disabled = uploadedPhotos.length < 2;
            if (uploadedPhotos.length >= 2) {
                confirmBtn.textContent = `‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (${uploadedPhotos.length} —Ñ–æ—Ç–æ)`;
            } else {
                confirmBtn.textContent = `‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (–º–∏–Ω. 2 —Ñ–æ—Ç–æ)`;
            }
        }
        
        // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
        async function confirmCompletion() {
            if (uploadedPhotos.length < 2) {
                alert('–ó–∞–≥—Ä—É–∑–∏—Ç–µ –º–∏–Ω–∏–º—É–º 2 —Ñ–æ—Ç–æ');
                return;
            }
            
            confirmBtn.disabled = true;
            confirmBtn.textContent = '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...';
            
            try {
                const comment = document.getElementById('workComment').value;
                
                const completionData = {
                    orderId: orderData.id,
                    photos: uploadedPhotos.map(p => p.url),
                    comment: comment,
                    timestamp: new Date().toISOString(),
                    status: 'completed'
                };
                
                // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ localStorage
                const completions = JSON.parse(localStorage.getItem('completions') || '[]');
                completions.push(completionData);
                localStorage.setItem('completions', JSON.stringify(completions));
                
                // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞
                const orders = JSON.parse(localStorage.getItem('orders') || '[]');
                const orderIndex = orders.findIndex(o => o.id === orderData.id);
                if (orderIndex !== -1) {
                    orders[orderIndex].status = 'completed';
                    orders[orderIndex].completion_date = new Date().toISOString();
                    localStorage.setItem('orders', JSON.stringify(orders));
                }
                
                // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞
                document.getElementById('confirmScreen').style.display = 'none';
                document.getElementById('successScreen').style.display = 'block';
                
                // –ó–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —É—Å–ø–µ—Ö–∞
                document.getElementById('successOrderAmount').textContent = orderData.total.toLocaleString('ru-RU') + ' ‚ÇΩ';
                document.getElementById('successCommission').textContent = Math.round(orderData.total * PLATFORM_COMMISSION).toLocaleString('ru-RU') + ' ‚ÇΩ';
                document.getElementById('successPayout').textContent = Math.round(orderData.total * MASTER_PAYOUT).toLocaleString('ru-RU') + ' ‚ÇΩ';
                
                // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram (—Ä–µ–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
                // await sendToTelegram(completionData);
                
            } catch (error) {
                alert('–û—à–∏–±–∫–∞: ' + error.message);
                confirmBtn.disabled = false;
                confirmBtn.textContent = '‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ';
            }
        }
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
        async function sendToTelegram(data) {
            const message = `
‚úÖ –†–ê–ë–û–¢–ê –ó–ê–í–ï–†–®–ï–ù–ê

–ó–∞–∫–∞–∑: #${data.orderId}
–§–æ—Ç–æ: ${data.photos.length} —à—Ç.
–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${data.comment || '–ë–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è'}

–û–∂–∏–¥–∞–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞.
            `.trim();
            
            console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram:', message);
            
            // –†–µ–∞–ª—å–Ω—ã–π API –≤—ã–∑–æ–≤
            /*
            await fetch('https://api.telegram.org/bot<TOKEN>/sendMessage', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    chat_id: '<CHAT_ID>',
                    text: message
                })
            });
            */
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.addEventListener('DOMContentLoaded', loadOrderData);
    </script>
</body>
</html>
