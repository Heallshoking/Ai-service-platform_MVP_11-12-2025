#!/usr/bin/expect -f
set timeout 30
set password "pneDRE2K?Tz1k-"
set host "root@176.98.178.109"

puts "\nðŸ”§ ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° app.balt-set.ru...\n"

spawn ssh $host
expect "password:"
send "$password\r"
expect "# "

puts "ðŸ“ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¹..."
send "mkdir -p /var/www/app_balt_set/data/www/app.balt-set.ru\r"
expect "# "

send "mkdir -p /etc/nginx/fastpanel2-available/app_balt_set\r"
expect "# "

puts "âœ… Ð”Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹\n"
puts "ðŸ“ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Nginx ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸...\n"

send "cat > /etc/nginx/fastpanel2-available/app_balt_set/app.balt-set.ru.conf << 'NGINX_EOF'
server {
    listen 80;
    listen \[::]:80;
    server_name app.balt-set.ru www.app.balt-set.ru;
    
    root /var/www/app_balt_set/data/www/app.balt-set.ru;
    index index.html index.htm calculator.html;
    
    location / {
        try_files \\\$uri \\\$uri/ =404;
    }
    
    location ~ /\\.ht {
        deny all;
    }
}
NGINX_EOF\r"
expect "# "

puts "âœ… ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð°\n"
puts "ðŸ”— Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÑÐ¸Ð¼Ð»Ð¸Ð½ÐºÐ°...\n"

send "ln -sf /etc/nginx/fastpanel2-available/app_balt_set/app.balt-set.ru.conf /etc/nginx/sites-enabled/app.balt-set.ru.conf\r"
expect "# "

puts "âœ… Ð¡Ð¸Ð¼Ð»Ð¸Ð½Ðº ÑÐ¾Ð·Ð´Ð°Ð½\n"
puts "ðŸ§ª Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸...\n"

send "nginx -t\r"
expect "# "

puts "ðŸ”„ ÐŸÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Nginx...\n"

send "systemctl reload nginx\r"
expect "# "

puts "âœ… Nginx Ð¿ÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½\n"

send "exit\r"
expect eof

puts "\nðŸ“¤ ÐšÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð¾Ð² ÐºÐ°Ð»ÑŒÐºÑƒÐ»ÑÑ‚Ð¾Ñ€Ð°...\n"

spawn scp /Users/user/Documents/Projects/Github/balt-set.ru/static/calculator.html $host:/var/www/app_balt_set/data/www/app.balt-set.ru/calculator.html
expect "password:"
send "$password\r"
expect eof

puts "âœ… HTML ÑÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½\n"

spawn scp /Users/user/Documents/Projects/Github/balt-set.ru/static/calculator.js $host:/var/www/app_balt_set/data/www/app.balt-set.ru/calculator.js
expect "password:"
send "$password\r"
expect eof

puts "âœ… JavaScript ÑÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½\n"

puts "\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
puts "ðŸŽ‰ Ð“ÐžÐ¢ÐžÐ’Ðž!"
puts "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
puts "\nðŸŒ ÐšÐ°Ð»ÑŒÐºÑƒÐ»ÑÑ‚Ð¾Ñ€ Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½ Ð¿Ð¾ Ð°Ð´Ñ€ÐµÑÑƒ:\n"
puts "   http://app.balt-set.ru/calculator.html\n"
puts "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n"
