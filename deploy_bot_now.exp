#!/usr/bin/expect -f
set timeout 120

puts "\nüöÄ –î–µ–ø–ª–æ–π –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ Telegram –±–æ—Ç–∞\n"

# –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª
puts "üì¶ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ telegram_lead_bot.py..."
spawn scp telegram_lead_bot.py root@176.98.178.109:/root/baltset_bot.py
expect "password:"
send "pneDRE2K?Tz1k-\r"
expect eof
puts "‚úÖ –§–∞–π–ª —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω\n"

# –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º
puts "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞...\n"
spawn ssh root@176.98.178.109
expect "password:"
send "pneDRE2K?Tz1k-\r"

expect "#"
send "killall -9 python3 2>/dev/null; pkill -9 -f baltset 2>/dev/null\r"
expect "#"
puts "‚úÖ –°—Ç–∞—Ä—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"

send "sleep 3\r"
expect "#"

send "cd /root && nohup python3 baltset_bot.py > baltset_bot.log 2>&1 &\r"
expect "#"
puts "‚úÖ –ù–æ–≤—ã–π –±–æ—Ç –∑–∞–ø—É—â–µ–Ω –≤ —Ñ–æ–Ω–µ"

send "sleep 5\r"
expect "#"

send "pgrep -f baltset_bot.py\r"
expect {
    -re "(\[0-9\]+)" {
        puts "\n================================"
        puts "‚úÖ –ë–û–¢ –£–°–ü–ï–®–ù–û –ó–ê–ü–£–©–ï–ù!"
        puts "================================"
        puts "\nPID: $expect_out(1,string)\n"
    }
    "#" {
        puts "\n‚ö†Ô∏è  –ü—Ä–æ—Ü–µ—Å—Å –Ω–µ –Ω–∞–π–¥–µ–Ω"
    }
}

send "tail -20 baltset_bot.log\r"
expect "#"

send "exit\r"
expect eof

puts "\nüéâ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à—ë–Ω!\n"
puts "üì± –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: https://t.me/Baltset39_bot"
puts "üí¨ –ù–∞–ø–∏—à–∏—Ç–µ /start\n"
